
namespace = cc_su_perf

#monthly
event = {
	id = cc_su_perf.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = awakened_fallen_empire
				}
				
				has_technology = tech_ccrebel_unrest_1

				AND = {
					OR = {
						has_country_resource = {
							type = minerals
							amount > 1200
						}
						has_monthly_income = {
							resource = minerals
							value > 60
						}
					}
					OR = {
						has_monthly_income = {
							resource = energy
							value > 60
						}
						energy > 1200
					}
				}

				any_neighbor_country = {
					OR = {
						is_country_type = default
						is_country_type = awakened_fallen_empire
					}
					NOR = {
						is_same_value = prev
						is_in_federation_with = prev
						opinion = {
							who = prev
							value > -50
						}			
					}
				
					prev = {
						OR = {
							is_threatened_to = prev
							is_hostile_to = prev
							is_dismissive_to = prev
							is_patronizing_to = prev
							is_angry_to = prev
							is_rival = prev
							is_unfriendly_to = prev
							is_disloyal_to = prev
							is_domineering_to = prev
							is_belligerent_to = prev
							is_imperious_to = prev
							is_berserker_to = prev
		#					is_wary_to = prev
						}
						if = {
							limit = { exists = overlord }
							NOT = {
								overlord = {
									NOT = {
										prev = {
											OR = {
												is_hostile_to = prev
												is_disloyal_to = prev
											}
										}
									}
									OR = {
										is_in_federation_with = prevprev
										prevprev = {
											opinion = {
												who = prev
												value > 0
											}
										}
									}
								}
							}
						}
					}
				}
			}
			every_neighbor_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = awakened_fallen_empire
					}
					NOR = {
						is_same_value = prev
						is_in_federation_with = prev
						opinion = {
							who = prev
							value > -50
						}			
					}
				
					prev = {
						OR = {
							is_threatened_to = prev
							is_hostile_to = prev
							is_dismissive_to = prev
							is_patronizing_to = prev
							is_angry_to = prev
							is_rival = prev
							is_unfriendly_to = prev
							is_disloyal_to = prev
							is_domineering_to = prev
							is_belligerent_to = prev
							is_imperious_to = prev
							is_berserker_to = prev
		#					is_wary_to = prev
						}
						if = {
							limit = { exists = overlord }
							NOT = {
								overlord = {
									NOT = {
										prev = {
											OR = {
												is_hostile_to = prev
												is_disloyal_to = prev
											}
										}
									}
									OR = {
										is_in_federation_with = prevprev
										prevprev = {
											opinion = {
												who = prev
												value > 0
											}
										}
									}
								}
							}
						}
					}
				}
				prev = {
					every_owned_planet = {
						limit = {
							is_neighbor_of = prevprev
							NOT = { has_planet_flag = cc_su_perf_planet_sowing_unrest }
							
							if = {
								limit = { prev = { has_technology = tech_ccrebel_unrest_2 } }
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										has_owner = yes
										owner = { is_same_value = prevprevprev }
										any_planet = {
											is_colony = yes
											is_being_stirred_up = no
											any_owned_pop = { has_a_happiness_gauge = yes }
										}
									}
								}
								else = {
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											has_owner = yes
											owner = { is_same_value = prevprevprev }
											any_planet = {
												is_colony = yes
												is_being_stirred_up = no
												any_owned_pop = { has_a_happiness_gauge = yes }
											}
										}
									}
								}
							}
						}
						set_timed_planet_flag = {
							flag = ccrebel_planet_can_sow_unrest
							days = 31
						}
						
						planet_event = { id = cc_su_perf.2 }
					}
				}
			}
		}
	}
}

planet_event = {
	id = cc_su_perf.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = { save_event_target_as = ccrebel_su_solar_system }
		if = {
			limit = {
				owner = {
					any_owned_planet = {
						has_planet_flag = cc_planet_sowing_unrest_marker
					}
				}
			}
			if = {
				limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
				closest_system = {
					min_steps = 0
					max_steps = 3
					limit = {
						has_star_flag = cc_planet_sowing_unrest_marker_system
						has_owner = yes
						owner = { is_same_value = root.owner }
					}
				}
				else = {
					closest_system = {
						min_steps = 0
						max_steps = 2
						limit = {
							has_star_flag = cc_planet_sowing_unrest_marker_system
							has_owner = yes
							owner = { is_same_value = root.owner }
						}
					}
				}
			}
			set_timed_planet_flag = {
				flag = cc_su_perf_too_close
				days = 31
			}
		}
			
		root.owner = {
			every_neighbor_country = {
				limit = {
					root = { is_neighbor_of = prev }
					OR = {
						is_country_type = default
						is_country_type = awakened_fallen_empire
					}
					NOR = {
						is_same_value = root.owner
						is_in_federation_with = root.owner
						opinion = {
							who = root.owner
							value > -50
						}					
					}
					
					root.owner = {
						OR = {
							is_threatened_to = prev
							is_hostile_to = prev
							is_dismissive_to = prev
							is_patronizing_to = prev
							is_angry_to = prev
							is_rival = prev
							is_unfriendly_to = prev
							is_disloyal_to = prev
							is_domineering_to = prev
							is_belligerent_to = prev
							is_imperious_to = prev
							is_berserker_to = prev
		#					is_wary_to = prev
						}
						if = {
							limit = { exists = overlord }
							NOT = {
								overlord = {
									NOT = {
										root.owner = {
											OR = {
												is_hostile_to = prev
												is_disloyal_to = prev
											}
										}
									}
									OR = {
										is_in_federation_with = prevprev
										prevprev = {
											opinion = {
												who = prev
												value > 0
											}
										}
									}
								}
							}
						}
					}
					any_owned_planet = {
						is_being_stirred_up = no
						any_owned_pop = { has_a_happiness_gauge = yes }
						if = {
							limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
							closest_system = {
								min_steps = 1
								max_steps = 6
								limit = {
									is_same_value = event_target:ccrebel_su_solar_system
								}
							}
							else = {
								closest_system = {
									min_steps = 1
									max_steps = 4
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
							}
						}
					}
				}
				
				if = {
					limit = {
						OR = {
							has_modifier = vulnerable_state_1
							has_modifier = vulnerable_state_2
							has_modifier = lost_war_vulnerable_state
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_vulnerable
							days = 31
						}
					}
				}
				if = {
					limit = { is_at_war_with = root.owner }
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_at_war
							days = 31
						}
					}
				}
				if = {
					limit = {
						has_policy_flag = slavery_allowed
						any_owned_planet = {
							is_being_stirred_up = no
							any_owned_pop = {
								has_a_happiness_gauge = yes
								is_enslaved = yes
							}
							if = {
								limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
								else = {
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
								}
							}
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_slave
							days = 31
						}
					}
					if = {
						limit = {
							OR = {
								has_ethic = ethic_xenophobe
								has_ethic = ethic_fanatic_xenophobe
							}
						}
						root = {
							set_timed_planet_flag = {
								flag = cc_su_perf_slave_phobe
								days = 31
							}
						}
					}
				}
				if = {
					limit = {
						any_owned_planet = {
							pop_percentage = {
								percentage > 0.25
								limit = {
									has_a_happiness_gauge = yes
									is_same_species = root.owner
								}
							}
							is_being_stirred_up = no
							if = {
								limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
								else = {
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
								}
							}
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_same_species
							days = 31
						}
					}
					if = {
						limit = {
							any_owned_planet = {
								pop_percentage = {
									percentage > 0.60
									limit = {
										has_a_happiness_gauge = yes
										is_same_species = root.owner
									}
								}
								is_being_stirred_up = no
								if = {
									limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
									closest_system = {
										min_steps = 1
										max_steps = 6
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
									else = {
										closest_system = {
											min_steps = 1
											max_steps = 4
											limit = {
												is_same_value = event_target:ccrebel_su_solar_system
											}
										}
									}
								}
							}
						}
						root = {
							set_timed_planet_flag = {
								flag = cc_su_perf_many_same_species
								days = 31
							}
						}
					}
				}
				if = {
					limit = { is_ai = no }
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_vs_player
							days = 31
						}
					}
				}
				if = {
					limit = {
						any_owned_planet = {
							any_owned_pop = { has_a_happiness_gauge = yes }
							is_being_stirred_up = no
							
							if = {
								limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
								unrest > 20
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
								else = {
									unrest > 30
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
								}
							}
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_some_unrest
							days = 31
						}
					}
					if = {
						limit = {
							any_owned_planet = {
								any_owned_pop = { has_a_happiness_gauge = yes }
								is_being_stirred_up = no
								
								if = {
									limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
									unrest > 40
									closest_system = {
										min_steps = 1
										max_steps = 6
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
									else = {
										unrest > 50
										closest_system = {
											min_steps = 1
											max_steps = 4
											limit = {
												is_same_value = event_target:ccrebel_su_solar_system
											}
										}
									}
								}
							}
						}
						root = {
							set_timed_planet_flag = {
								flag = cc_su_perf_lots_unrest
								days = 31
							}
						}
					}
				}
				if = {
					limit = {
						OR = {
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_hive_devouring_swarm
							has_valid_civic = civic_machine_terminator
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_purifiers
							days = 31
						}
					}
				}
				if = {
					limit = {
						root.owner = {
							OR = {
								is_hostile_to = prev
								is_angry_to = prev
								is_rival = prev
								is_disloyal_to = prev
								is_domineering_to = prev
								is_berserker_to = prev
							}
						}
					}
					root = {
						set_timed_planet_flag = {
							flag = cc_su_perf_enemy
							days = 31
						}
					}
				}
				
				#Multitude of planets test
				random_owned_planet = {
					limit = {
						any_owned_pop = { has_a_happiness_gauge = yes }
						is_being_stirred_up = no
						
						if = {
							limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
							closest_system = {
								min_steps = 1
								max_steps = 6
								limit = {
									is_same_value = event_target:ccrebel_su_solar_system
								}
							}
							else = {
								closest_system = {
									min_steps = 1
									max_steps = 4
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
							}
						}
					}
					save_event_target_as = cc_su_first_planet
				}
				if = {
					limit = {
						any_owned_planet = {
							NOT = { is_same_value = event_target:cc_su_first_planet }
							any_owned_pop = { has_a_happiness_gauge = yes }
							is_being_stirred_up = no
							
							if = {
								limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
								else = {
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
								}
							}
						}
					}
					random_owned_planet = {
						limit = {
							NOT = { is_same_value = event_target:cc_su_first_planet }
							any_owned_pop = { has_a_happiness_gauge = yes }
							is_being_stirred_up = no
							
							if = {
								limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
								closest_system = {
									min_steps = 1
									max_steps = 6
									limit = {
										is_same_value = event_target:ccrebel_su_solar_system
									}
								}
								else = {
									closest_system = {
										min_steps = 1
										max_steps = 4
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
								}
							}
						}
						save_event_target_as = cc_su_second_planet
					}
					if = {
						limit = {
							any_owned_planet = {
								NOR = {
									is_same_value = event_target:cc_su_first_planet
									is_same_value = event_target:cc_su_second_planet
								}
								any_owned_pop = { has_a_happiness_gauge = yes }
								is_being_stirred_up = no
								
								if = {
									limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
									closest_system = {
										min_steps = 1
										max_steps = 6
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
									else = {
										closest_system = {
											min_steps = 1
											max_steps = 4
											limit = {
												is_same_value = event_target:ccrebel_su_solar_system
											}
										}
									}
								}
							}
						}
						random_owned_planet = {
							limit = {
								NOR = {
									is_same_value = event_target:cc_su_first_planet
									is_same_value = event_target:cc_su_second_planet
								}
								any_owned_pop = { has_a_happiness_gauge = yes }
								is_being_stirred_up = no
								
								if = {
									limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
									closest_system = {
										min_steps = 1
										max_steps = 6
										limit = {
											is_same_value = event_target:ccrebel_su_solar_system
										}
									}
									else = {
										closest_system = {
											min_steps = 1
											max_steps = 4
											limit = {
												is_same_value = event_target:ccrebel_su_solar_system
											}
										}
									}
								}
							}
							save_event_target_as = cc_su_third_planet
						}
						root = {
							set_timed_planet_flag = {
								flag = cc_su_perf_three_targets
								days = 31
							}
						}
						if = {
							limit = {
								any_owned_planet = {
									NOR = {
										is_same_value = event_target:cc_su_first_planet
										is_same_value = event_target:cc_su_second_planet
										is_same_value = event_target:cc_su_third_planet
									}
									any_owned_pop = { has_a_happiness_gauge = yes }
									is_being_stirred_up = no
									
									if = {
										limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
										closest_system = {
											min_steps = 1
											max_steps = 6
											limit = {
												is_same_value = event_target:ccrebel_su_solar_system
											}
										}
										else = {
											closest_system = {
												min_steps = 1
												max_steps = 4
												limit = {
													is_same_value = event_target:ccrebel_su_solar_system
												}
											}
										}
									}
								}
							}
							root = {
								set_timed_planet_flag = {
									flag = cc_su_perf_four_targets
									days = 31
								}
							}
							if = {
								limit = {
									any_owned_planet = {
										NOR = {
											is_same_value = event_target:cc_su_first_planet
											is_same_value = event_target:cc_su_second_planet
											is_same_value = event_target:cc_su_third_planet
										}
										any_owned_pop = { has_a_happiness_gauge = yes }
										is_being_stirred_up = no
										
										if = {
											limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
											closest_system = {
												min_steps = 1
												max_steps = 6
												limit = {
													is_same_value = event_target:ccrebel_su_solar_system
												}
											}
											else = {
												closest_system = {
													min_steps = 1
													max_steps = 4
													limit = {
														is_same_value = event_target:ccrebel_su_solar_system
													}
												}
											}
										}
										owner = {
											any_owned_planet = {
												NOR = {
													is_same_value = prevprev
													is_same_value = event_target:cc_su_first_planet
													is_same_value = event_target:cc_su_second_planet
													is_same_value = event_target:cc_su_third_planet
												}
												any_owned_pop = { has_a_happiness_gauge = yes }
												is_being_stirred_up = no
												
												if = {
													limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
													closest_system = {
														min_steps = 1
														max_steps = 6
														limit = {
															is_same_value = event_target:ccrebel_su_solar_system
														}
													}
													else = {
														closest_system = {
															min_steps = 1
															max_steps = 4
															limit = {
																is_same_value = event_target:ccrebel_su_solar_system
															}
														}
													}
												}
											}
										}
									}
								}
								root = {
									set_timed_planet_flag = {
										flag = cc_su_perf_five_targets
										days = 31
									}
								}
								if = {
									limit = {
										any_owned_planet = {
											NOR = {
												is_same_value = event_target:cc_su_first_planet
												is_same_value = event_target:cc_su_second_planet
												is_same_value = event_target:cc_su_third_planet
											}
											any_owned_pop = { has_a_happiness_gauge = yes }
											is_being_stirred_up = no
											
											if = {
												limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
												closest_system = {
													min_steps = 1
													max_steps = 6
													limit = {
														is_same_value = event_target:ccrebel_su_solar_system
													}
												}
												else = {
													closest_system = {
														min_steps = 1
														max_steps = 4
														limit = {
															is_same_value = event_target:ccrebel_su_solar_system
														}
													}
												}
											}
											owner = {
												any_owned_planet = {
													NOR = {
														is_same_value = prevprev
														is_same_value = event_target:cc_su_first_planet
														is_same_value = event_target:cc_su_second_planet
														is_same_value = event_target:cc_su_third_planet
													}
													any_owned_pop = { has_a_happiness_gauge = yes }
													is_being_stirred_up = no
													
													if = {
														limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
														closest_system = {
															min_steps = 1
															max_steps = 6
															limit = {
																is_same_value = event_target:ccrebel_su_solar_system
															}
														}
														else = {
															closest_system = {
																min_steps = 1
																max_steps = 4
																limit = {
																	is_same_value = event_target:ccrebel_su_solar_system
																}
															}
														}
													}
													owner = {
														any_owned_planet = {
															NOR = {
																is_same_value = prevprev
																is_same_value = prevprevprevprev
																is_same_value = event_target:cc_su_first_planet
																is_same_value = event_target:cc_su_second_planet
																is_same_value = event_target:cc_su_third_planet
															}
															any_owned_pop = { has_a_happiness_gauge = yes }
															is_being_stirred_up = no
															
															if = {
																limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
																closest_system = {
																	min_steps = 1
																	max_steps = 6
																	limit = {
																		is_same_value = event_target:ccrebel_su_solar_system
																	}
																}
																else = {
																	closest_system = {
																		min_steps = 1
																		max_steps = 4
																		limit = {
																			is_same_value = event_target:ccrebel_su_solar_system
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
									root = {
										set_timed_planet_flag = {
											flag = cc_su_perf_six_targets
											days = 31
										}
									}
								}
							}
						}
						if = {
							limit = {
								root.owner = {
									any_neighbor_country = {
										root = { is_neighbor_of = prev }
										NOT = { is_same_value = prevprev }
										OR = {
											is_country_type = default
											is_country_type = awakened_fallen_empire
										}
										NOR = {
											is_same_value = root.owner
											is_in_federation_with = root.owner
											opinion = {
												who = root.owner
												value > -50
											}
										}
										root.owner = {
											OR = {
												is_threatened_to = prev
												is_hostile_to = prev
												is_dismissive_to = prev
												is_patronizing_to = prev
												is_angry_to = prev
												is_rival = prev
												is_unfriendly_to = prev
												is_disloyal_to = prev
												is_domineering_to = prev
												is_belligerent_to = prev
												is_imperious_to = prev
												is_berserker_to = prev
							#					is_wary_to = prev
											}
											if = {
												limit = { exists = overlord }
												NOT = {
													overlord = {
														NOT = {
															prev = {
																OR = {
																	is_hostile_to = prev
																	is_disloyal_to = prev
																}
															}
														}
														OR = {
															is_in_federation_with = prevprev
															prevprev = {
																opinion = {
																	who = prev
																	value > 0
																}
															}
														}
													}
												}
											}
										}
										any_owned_planet = {
											any_owned_pop = { has_a_happiness_gauge = yes }
											is_being_stirred_up = no
											if = {
												limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
												closest_system = {
													min_steps = 1
													max_steps = 6
													limit = {
														is_same_value = event_target:ccrebel_su_solar_system
													}
												}
												else = {
													closest_system = {
														min_steps = 1
														max_steps = 4
														limit = {
															is_same_value = event_target:ccrebel_su_solar_system
														}
													}
												}
											}
											owner = {
												any_owned_planet = {
													any_owned_pop = { has_a_happiness_gauge = yes }
													NOT = { is_same_value = prevprev }
													is_being_stirred_up = no
												
													if = {
														limit = { root.owner = { has_technology = tech_ccrebel_unrest_2 } }
														closest_system = {
															min_steps = 1
															max_steps = 6
															limit = {
																is_same_value = event_target:ccrebel_su_solar_system
															}
														}
														else = {
															closest_system = {
																min_steps = 1
																max_steps = 4
																limit = {
																	is_same_value = event_target:ccrebel_su_solar_system
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							root = {
								set_timed_planet_flag = {
									flag = cc_su_perf_three_two_targets
									days = 31
								}
							}
						}
					}
				}
			}
		}
	}
}